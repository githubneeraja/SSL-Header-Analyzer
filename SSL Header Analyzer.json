{
  "name": "SSL Header Analyze",
  "nodes": [
    {
      "parameters": {
        "formTitle": "website security scanner",
        "formDescription": "Check your website for security Vulnerabilities and get a detailed report. ",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Landing page URL",
              "placeholder": "http://example.com",
              "requiredField": true
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.3,
      "position": [
        -480,
        112
      ],
      "id": "af96b27c-aa71-4568-9b81-a66dbe23b9da",
      "name": "Landing Page URL",
      "webhookId": "117557b3-2407-436d-9dd8-9401d065c17e"
    },
    {
      "parameters": {
        "url": "={{ $json[\"url\"] ? $json[\"url\"].startsWith('http') ? $json[\"url\"] : 'https://' + $json[\"url\"] : 'https://example.com' }}\n",
        "options": {
          "redirect": {
            "redirect": {
              "maxRedirects": 5
            }
          },
          "response": {
            "response": {
              "fullResponse": true,
              "responseFormat": "text"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -256,
        112
      ],
      "id": "7abdec4f-0b43-4897-a240-bef012fb65bd",
      "name": "Scrape Website"
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one,\nlet formattedHeaders = '';\nif  (items[0].json.headers)  {\n  for (const key in items[0].json.headers)  {\n    formattedHeaders +=  '${key}: ${items[0].json.headers[key]}\\n';\n  }\n}\n\n// Return both the original data and the formatted headers\nreturn [{\n   json: {\n     ...items[0].json,\n     formattedHeaders:  formattedHeaders,\n     originalHeaders:  items[0].json.headers //  Keep the original headers too\n   }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        0
      ],
      "id": "77e30120-aed5-477d-be5e-d090c32af224",
      "name": "Extra Headers for Debug"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are an elite web security expert specializing in secure configurations.\n\nIn this task, you will analyze the HTTP headers, cookies, and overall configuration of a webpage to identify security misconfigurations.\n\nAudit Structure\nYou will begin by listening ALL security headers that are present and properly configured.\n\nBe very clear and explicit about which headers are present and which are missing , and if present, what its valueis.\n\nThen, present your findings in three sections:\n- Header security - Missing or misconfigured  security headers\n- Cookie security - Insecure cookie configurations\n- Content Security - CSP issues, mixed content, etc.\n\nFor each finding, provide:\n1. A clear description of the misconfiguration\n2. The security implications\n3. The recommended secure configuration with example code\n\nIf you find no issues in a particular section, explicitly state that no issues were found.\n\nUse proper formatting with code blocks for configuration examples. Only include issues that can be detected from client-side inspection.  \nHere are the response headers: {{ $json.formattedHeaders }}\n\nPlease respond like this \n\n### [any section heading that includes \"Headers]\n\n1. **[Headers Title]**\n   - **Present?** Yes/No\n   - **Value:** 'actual-header-value'",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        208,
        0
      ],
      "id": "adb8938b-ead1-424b-a741-2e8cd73c65de",
      "name": "Security Configuration Audit"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are an elite Cybersecurity expert specializing in web application security.\n\nIn this task, you will analyze the HTML and visible content of the webpage to identify potential security vulnerabilities.\n\nAudit Structure \nyou will review all client-side security aspects of the page and present your findings in three sections:\n- Critical Vulnerabilities - Issues that could lead to immediate compromise\n- Information Leakage - Sensitive data exposed in page source\n- Client-Side Weaknesses - JavaScript vulnerabilities, XSS opportunities, etc.\n\nFor each issue found, provide:\n1. A clear description of the vulnerability\n2. The potential impact\n3. A specific recommendation to fix it\n\nIf you find no issues in a particular section, explicitly state that no issues were found in that category.\n\nEnsure the output is properly formatted, clean, and highly readable. Focus only on issues that can be detected from the client-side code.\n\nHere is the content of the webpage: {{ $json.data }}\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        80,
        336
      ],
      "id": "8d29ac03-e869-4b25-8182-45991047efcf",
      "name": "Security Vulnerabilities Audit"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        608,
        144
      ],
      "id": "e8a72aa4-05cc-483c-91ce-5cc7a5b9b71a",
      "name": "Merge Security Results"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "output"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        816,
        144
      ],
      "id": "4be25b9d-93dc-4caf-b186-11526435b8d3",
      "name": "Aggregate Audit Results"
    },
    {
      "parameters": {
        "jsCode": "// ðŸ§  Safe header extraction\nconst configOutput = $json[\"Security Configuration Audit\"] || \"No configuration data\";\nconst vulnOutput = $json[\"Security Vulnerabilities Audit\"] || \"No vulnerability data\";\n\n// Try reading headers safely\nconst rawHeaders = $json[\"rawHeaders\"] || $json[\"headers\"] || {};\nconst headers = Object.fromEntries(\n  Object.entries(rawHeaders).map(([k, v]) => [k.toLowerCase(), v])\n);\n\n// ðŸ›¡ï¸ Security grading logic\nfunction gradeSecurity(headers) {\n  let score = 100;\n\n  // Defensive checks\n  if (!headers || Object.keys(headers).length === 0) return \"F\";\n\n  if (!headers[\"content-security-policy\"]) score -= 20;\n  if (!headers[\"strict-transport-security\"]) score -= 20;\n  if (!headers[\"x-content-type-options\"]) score -= 10;\n  if (!headers[\"x-frame-options\"]) score -= 10;\n  if (!headers[\"referrer-policy\"]) score -= 10;\n\n  return score >= 90 ? \"A\" :\n         score >= 75 ? \"B\" :\n         score >= 60 ? \"C\" : \"F\";\n}\n\n// ðŸ§© Prepare final audit data\nconst auditData = {\n  url: $json[\"url\"] || \"unknown\",\n  grade: gradeSecurity(headers),\n  presentHeaders: Object.keys(headers),\n  configOutput,\n  vulnOutput,\n  timestamp: new Date().toISOString()\n};\n\nreturn [{ json: { auditData } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1024,
        144
      ],
      "id": "e61a90b4-6ac1-4c14-9093-e4d495b30d0d",
      "name": "Process Audit Results"
    },
    {
      "parameters": {
        "jsCode": "const data = $json.auditData;\n\nconst html = `\n<h2>Website Security Audit Report</h2>\n<p><strong>URL:</strong> ${data.url}</p>\n<p><strong>Grade:</strong> ${data.grade}</p>\n<p><strong>Timestamp:</strong> ${data.timestamp}</p>\n\n<h3>Configuration Audit</h3>\n<pre>${data.configOutput}</pre>\n\n<h3>Vulnerability Audit</h3>\n<pre>${data.vulnOutput}</pre>\n`;\n\nreturn [{ json: { emailHtml: html, auditData: data } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1232,
        144
      ],
      "id": "ccfbb76d-686f-49a2-848e-a48cb0d0d011",
      "name": "Convert to HTML"
    },
    {
      "parameters": {
        "sendTo": "neerajab824@gmail.com",
        "subject": "=Website Security Audit - {{$json.auditData.url}}",
        "message": "={{$json.emailHtml}}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1440,
        144
      ],
      "id": "7904d9cb-18fd-4ccc-b386-3a23230dbc20",
      "name": "Send Security Report",
      "webhookId": "99898a5e-d6bb-49bb-a3cb-253b7d437852",
      "credentials": {
        "gmailOAuth2": {
          "id": "P191Yp9n2qPxIS5z",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        80,
        208
      ],
      "id": "b31b159c-ee70-4806-b81e-3cda7ca3de3b",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "KpiG0prOjt111KdK",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -64,
        576
      ],
      "id": "421b9413-5e96-425e-8afc-e3504c0d74d7",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "KpiG0prOjt111KdK",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.ssllabs.com/api/v3/analyze?host=google.com\n{{ $json[\"LandingPageURL\"].replace(/^https?:\\/\\//, \"\").replace(/\\/$/, \"\") }}\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -112,
        816
      ],
      "id": "a80d2a9d-1015-4972-956d-ee5760829da9",
      "name": "Check SSL"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "99e1577f-fcd8-47ae-a4e8-f87d5a145247",
              "leftValue": "={{ Number(new Date($json[\"valid_to\"]).getTime()) }}",
              "rightValue": "={{ Number(Date.now())}}",
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        256,
        816
      ],
      "id": "7776415d-5319-4a82-93c1-795a6bb23511",
      "name": "Expiry Alert"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are an elite cybersecurity analyst skilled in communicating technical findings to both technical and non-technical stakeholders.\n\nIn this task, you will formulate a concise and professional email message summarizing the results of an SSL/TLS security check for a web application server.\n\nEmail Content Requirements  \nYou will use the provided parameters to compose a clear, informative message. Structure the email with the following sections:\n\nOverview â€“ A brief summary of the purpose of the message\n\nFindings â€“ A structured presentation of each key technical detail:\n\nIP Address â€“ {{ $json.endpoints.ipAddress }}\n\nHost Domain â€“ {{ $json.host }}\n\nServer Name â€“ {{ $json.endpoints.serverName }}\n\nSSL Grade â€“ {{ $json.endpoints.grade }}\n\nGrade (Trust Ignored) â€“ {{ $json.endpoints.gradeTrustIgnored }}\n\nSecurity Implications â€“ A short paragraph explaining the security impact of the results.\n\nSecurity Implications â€“ A short paragraph explaining what the above SSL Grade implies for the security posture of the domain.\n\nRecommendations â€“ Specific and actionable steps to improve SSL/TLS configuration based on check findings.\n\nUse professional and clear language suitable for delivery to a technical lead, security manager, or client.\n\nEnsure the output is well-formatted, polite, and highly readable.\n\nImportant â€“ In your response donâ€™t start with responses like \"Okay, hereâ€™s the email draft summarizing the SSL/TLS security check results for ...\".\n\nJust mention the Title and Body in well formatted: use way. Do not place asterisk â€“ * in output.",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        624,
        800
      ],
      "id": "839d0e4c-d2b1-4458-8bfd-273b0b01045c",
      "name": "Warning Email Formulate"
    },
    {
      "parameters": {
        "sendTo": "neerajab824@gmail.com",
        "subject": "=SSL Certificate Expiry Alert - {{$json[\"domain\"]}}",
        "emailType": "text",
        "message": "=Hello,  The SSL certificate for {{ $json[\"domain\"] }} has {{ $json[\"status\"] }}.  Details: - Expiry Date: {{ $json[\"valid_to\"] }} - Days Left: {{ $json[\"diffDays\"] }}  Please take immediate action if expired or expiring soon.  â€” WebSecScan Bot",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        976,
        800
      ],
      "id": "662a6042-0dcb-455f-b3bf-dd435db0cd16",
      "name": "Send alert email",
      "webhookId": "70df8d9f-57c0-430b-9f5b-439cfa3650d4",
      "credentials": {
        "gmailOAuth2": {
          "id": "P191Yp9n2qPxIS5z",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        480,
        1008
      ],
      "id": "aacd0d17-c7dc-4647-8d35-1bfa954dde57",
      "name": "Google Gemini Chat Model- SSL Model",
      "credentials": {
        "googlePalmApi": {
          "id": "KpiG0prOjt111KdK",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Landing Page URL": {
      "main": [
        [
          {
            "node": "Check SSL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Scrape Website": {
      "main": [
        [
          {
            "node": "Extra Headers for Debug",
            "type": "main",
            "index": 0
          },
          {
            "node": "Security Vulnerabilities Audit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extra Headers for Debug": {
      "main": [
        [
          {
            "node": "Security Configuration Audit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Security Configuration Audit": {
      "main": [
        [
          {
            "node": "Merge Security Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Security Vulnerabilities Audit": {
      "main": [
        [
          {
            "node": "Merge Security Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Security Results": {
      "main": [
        [
          {
            "node": "Aggregate Audit Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Audit Results": {
      "main": [
        [
          {
            "node": "Process Audit Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Audit Results": {
      "main": [
        [
          {
            "node": "Convert to HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to HTML": {
      "main": [
        [
          {
            "node": "Send Security Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Security Configuration Audit",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Security Vulnerabilities Audit",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Check SSL": {
      "main": [
        [
          {
            "node": "Expiry Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Expiry Alert": {
      "main": [
        [
          {
            "node": "Warning Email Formulate",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Warning Email Formulate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Warning Email Formulate": {
      "main": [
        [
          {
            "node": "Send alert email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model- SSL Model": {
      "ai_languageModel": [
        [
          {
            "node": "Warning Email Formulate",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "64ca4dda-e19f-4fb3-b74e-4b78f9b2ef17",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "1d4c213ac2a788b7fdd65e4101de84ff833f73fafdb0206864d0b14f84644412"
  },
  "id": "M65xzKBxLJM7McKg",
  "tags": []
}